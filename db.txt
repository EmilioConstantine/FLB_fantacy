CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    budget_remaining INT DEFAULT 100,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE players (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    team VARCHAR(50),
    position VARCHAR(20),
    price INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE coaches (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    team VARCHAR(50),
    price INT NOT NULL,
    bonus_points INT DEFAULT 5,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_team (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    player1 INT,
    player2 INT,
    player3 INT,
    player4 INT,
    player5 INT,
    coach INT,
    FOREIGN KEY (user_id) REFERENCES users(id)
        ON DELETE CASCADE
);

CREATE TABLE weekly_stats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    player_id INT NOT NULL,
    week_number INT NOT NULL,
    points INT DEFAULT 0,
    rebounds INT DEFAULT 0,
    assists INT DEFAULT 0,
    steals INT DEFAULT 0,
    blocks INT DEFAULT 0,
    turnovers INT DEFAULT 0,
    FOREIGN KEY (player_id) REFERENCES players(id)
        ON DELETE CASCADE
);

CREATE TABLE user_points (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    week_number INT NOT NULL,
    fantasy_points INT DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id)
        ON DELETE CASCADE
);

CREATE TABLE admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(255) NOT NULL
);


CREATE TABLE matches (
    id INT AUTO_INCREMENT PRIMARY KEY,
    week_number INT NOT NULL,
    home_team VARCHAR(50),
    away_team VARCHAR(50),
    match_date DATE,
    status ENUM('SCHEDULED', 'FINISHED') DEFAULT 'SCHEDULED'
);




ALTER TABLE user_team
ADD COLUMN week_number INT NOT NULL DEFAULT 1 AFTER user_id,
ADD COLUMN team_name VARCHAR(100) NULL AFTER week_number;


CREATE TABLE user_team_members (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_team_id INT NOT NULL,
    player_id INT NULL,
    coach_id INT NULL,
    role ENUM('PLAYER', 'COACH') NOT NULL,
    is_captain TINYINT(1) DEFAULT 0,
    FOREIGN KEY (user_team_id) REFERENCES user_team(id) ON DELETE CASCADE,
    FOREIGN KEY (player_id) REFERENCES players(id) ON DELETE CASCADE,
    FOREIGN KEY (coach_id) REFERENCES coaches(id) ON DELETE CASCADE
);


ALTER TABLE user_team
DROP COLUMN player1,
DROP COLUMN player2,
DROP COLUMN player3,
DROP COLUMN player4,
DROP COLUMN player5,
DROP COLUMN coach;

ALTER TABLE weekly_stats
ADD COLUMN match_id INT NULL AFTER week_number,
ADD COLUMN minutes INT DEFAULT 0 AFTER turnovers,
ADD COLUMN fantasy_points INT DEFAULT 0 AFTER minutes,
ADD FOREIGN KEY (match_id) REFERENCES matches(id) ON DELETE SET NULL;


ALTER TABLE user_team
ADD COLUMN coach_id INT(11) UNSIGNED NULL;
ALTER TABLE user_team ADD COLUMN captain_id INT NULL;
ALTER TABLE user_team
ADD COLUMN created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE weekly_stats
ADD COLUMN created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP;
CREATE TABLE IF NOT EXISTS week_settings (
  week_number INT PRIMARY KEY,
  is_locked TINYINT(1) NOT NULL DEFAULT 0,
  locked_at DATETIME NULL
);
CREATE TABLE IF NOT EXISTS app_settings (
  id INT PRIMARY KEY DEFAULT 1,
  current_week INT NOT NULL DEFAULT 1,
  updated_at DATETIME NULL
);

INSERT INTO app_settings (id, current_week, updated_at)
VALUES (1, 1, NOW())
ON DUPLICATE KEY UPDATE id=id;
