<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel | LBL Fantasy</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body class="bg-gray-100">

  <!-- HEADER -->
  <header class="bg-white shadow-sm sticky top-0 z-50 px-4 py-3 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-flb-red rounded-lg flex items-center justify-center shadow text-white font-bold text-sm">
        FLB
      </div>
      <div>
        <h1 class="text-lg font-black tracking-tighter text-flb-red leading-none">LBL FANTASY</h1>
        <span class="text-[10px] font-bold text-gray-400 tracking-widest">ADMIN PANEL</span>
      </div>
    </div>

    <div class="flex items-center gap-4 text-gray-400">
      <a href="login.html" class="text-xs font-semibold hover:text-flb-red">Back to App</a>
      <button id="btnAdminLogout" type="button" class="text-xs font-semibold hover:text-flb-red">
        Logout
      </button>
    </div>
  </header>

  <main class="p-4 max-w-6xl mx-auto pb-24 space-y-6">

    <!-- ADMIN LOGIN AREA -->
    <section id="admin-login-area" class="bg-white rounded-2xl shadow-md p-5">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-black mb-1 flex items-center gap-2">
            <i class="fas fa-user-shield text-flb-red"></i> Admin Login
          </h2>
          <p class="text-xs text-gray-500">
            Use your admin credentials stored in the database.
          </p>
        </div>
        <div class="text-[11px] text-gray-400">
          Session based
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
        <div>
          <label class="text-xs font-semibold text-gray-600 block mb-1">Username</label>
          <input id="admin-username" type="text"
                 class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                 placeholder="admin" />
        </div>
        <div>
          <label class="text-xs font-semibold text-gray-600 block mb-1">Password</label>
          <input id="admin-password" type="password"
                 class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                 placeholder="••••••••" />
        </div>
        <div class="flex items-end">
          <button id="btnAdminLogin" type="button" class="btn-primary w-full text-sm py-2">
            Login
          </button>
        </div>
      </div>
    </section>

    <!-- ADMIN PANEL AREA -->
    <div id="admin-panel-area" style="display:none;" class="space-y-6">

      <!-- SESSION STATUS -->
      <section class="bg-white rounded-2xl shadow-md p-5">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h2 class="text-lg font-black mb-1 flex items-center gap-2">
              <i class="fas fa-shield-halved text-flb-red"></i> Session Status
            </h2>
            <p class="text-xs text-gray-500">Admin session must be active to use tools below.</p>
          </div>

          <div class="flex items-center gap-2">
            <span id="admin-session-pill"
                  class="px-3 py-1 rounded-full text-[11px] font-bold bg-gray-100 text-gray-700">
              Checking...
            </span>
          </div>
        </div>
      </section>

      <!-- WEEKLY CONTROL ROW -->
      <section class="bg-white rounded-2xl shadow p-5">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h2 class="text-lg font-black text-gray-800">Gameweek Control</h2>
            <p class="text-xs text-gray-500">Run scoring and lock/unlock team changes for a week.</p>
          </div>

          <div class="flex items-center gap-2">
            <span id="week-lock-badge"
                  class="px-2 py-1 rounded-full text-[11px] font-bold bg-gray-100 text-gray-600">
              Checking...
            </span>

            <button id="btn-week-lock-toggle" type="button" class="btn-primary text-xs px-3 py-2">
              Lock Week
            </button>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap items-center gap-3 text-sm">
          <label class="font-semibold">Week</label>
          <input id="admin-week" type="number"
                 class="border rounded-xl px-3 py-2 w-28 text-sm outline-none focus:ring-2 focus:ring-red-200"
                 value="1" />

          <!-- NEW: SET CURRENT WEEK -->
          <button id="btn-set-current-week" type="button" class="btn-primary text-xs px-4 py-2">
            <i class="fas fa-calendar-check mr-2"></i>Set Current Week
          </button>

          <span id="current-week-pill"
                class="px-3 py-1 rounded-full text-[11px] font-bold bg-gray-100 text-gray-700">
            Current: —
          </span>

          <button id="btn-run-scoring" type="button" class="btn-primary text-xs px-4 py-2">
            <i class="fas fa-bolt mr-2"></i>Run Scoring
          </button>

          <button id="btn-recalc" type="button" class="btn-secondary text-xs px-4 py-2">
            <i class="fas fa-rotate mr-2"></i>Recalculate
          </button>

          <button id="btn-load-teams" type="button"
                  class="ml-auto text-xs px-4 py-2 rounded-xl bg-gray-100 hover:bg-gray-200">
            <i class="fas fa-users mr-2"></i>Load Teams
          </button>
        </div>
      </section>

      <!-- TEAMS TABLE -->
      <section class="bg-white rounded-2xl shadow p-5">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-black text-gray-800">Teams for Week</h2>
          <span class="text-[11px] text-gray-500">Scroll table if large</span>
        </div>
        <div id="teams-table" class="mt-3 text-xs max-h-80 overflow-y-auto border rounded-xl"></div>
      </section>

      <!-- PRICE MANAGEMENT -->
      <section class="bg-white rounded-2xl shadow p-5">
        <h2 class="text-lg font-black text-gray-800 mb-1">Player Prices</h2>
        <p class="text-xs text-gray-500 mb-4">Update a single player price quickly.</p>

        <div class="flex flex-wrap items-center gap-3 text-sm">
          <label class="font-semibold">Player ID</label>
          <input id="price-player-id" type="number"
                 class="border rounded-xl px-3 py-2 w-28 text-sm outline-none focus:ring-2 focus:ring-red-200" />
          <label class="font-semibold">New Price</label>
          <input id="price-new" type="number"
                 class="border rounded-xl px-3 py-2 w-28 text-sm outline-none focus:ring-2 focus:ring-red-200" />
          <button id="btn-price-single" type="button" class="btn-primary text-xs px-4 py-2">
            Update
          </button>
        </div>
      </section>

      <!-- ADD PLAYER -->
      <section class="bg-white rounded-2xl shadow-md p-5">
        <h2 class="text-lg font-black flex items-center gap-2 mb-4">
          <i class="fas fa-basketball-ball text-flb-red"></i> Add Player
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Name</label>
            <input id="ap_name" type="text"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="Player Name" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Team</label>
            <input id="ap_team" type="text"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="Team" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Position</label>
            <input id="ap_position" type="text"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="PG/SG/SF/PF/C" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Price</label>
            <input id="ap_price" type="number"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="10" />
          </div>
        </div>

        <button id="btnAddPlayer" type="button" class="btn-primary text-sm px-4 py-2">Save Player</button>
      </section>

      <!-- ADD COACH -->
      <section class="bg-white rounded-2xl shadow-md p-5">
        <h2 class="text-lg font-black flex items-center gap-2 mb-4">
          <i class="fas fa-chalkboard-teacher text-flb-red"></i> Add Coach
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Name</label>
            <input id="ac_name" type="text"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="Coach Name" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Team</label>
            <input id="ac_team" type="text"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="Team" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Price</label>
            <input id="ac_price" type="number"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="5" />
          </div>
          <div>
            <label class="text-xs font-semibold text-gray-600 block mb-1">Bonus Pts</label>
            <input id="ac_bonus" type="number"
                   class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200"
                   placeholder="5" />
          </div>
        </div>

        <button id="btnAddCoach" type="button" class="btn-primary text-sm px-4 py-2">Save Coach</button>
      </section>

      <!-- ADD STATS -->
      <section class="bg-white rounded-2xl shadow-md p-5">
        <h2 class="text-lg font-black flex items-center gap-2 mb-4">
          <i class="fas fa-chart-line text-flb-red"></i> Add Weekly Stats
        </h2>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Player ID</label><input id="s_player_id" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Week</label><input id="s_week" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Points</label><input id="s_points" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Rebounds</label><input id="s_rebounds" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Assists</label><input id="s_assists" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Steals</label><input id="s_steals" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Blocks</label><input id="s_blocks" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Turnovers</label><input id="s_turnovers" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
          <div><label class="text-xs font-semibold text-gray-600 block mb-1">Minutes</label><input id="s_minutes" type="number" class="w-full border rounded-xl px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-red-200" /></div>
        </div>

        <button id="btnAddStats" type="button" class="btn-primary text-sm px-4 py-2">Save Stats &amp; Update Fantasy Points</button>
      </section>

    </div>
  </main>

  <!-- NICE ALERT MODAL -->
  <div id="ui-alert" class="hidden fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
      <div class="px-5 py-4 flex items-center gap-3 bg-gray-50 border-b">
        <div id="ui-alert-icon" class="w-10 h-10 rounded-xl flex items-center justify-center bg-gray-200 text-gray-700">
          <i class="fas fa-circle-info"></i>
        </div>
        <div class="min-w-0">
          <div id="ui-alert-title" class="font-black text-gray-900">Message</div>
          <div id="ui-alert-sub" class="text-xs text-gray-500">Info</div>
        </div>
        <button id="ui-alert-close-x" type="button"
                class="ml-auto w-9 h-9 rounded-full bg-white border hover:bg-gray-50 flex items-center justify-center">
          <i class="fas fa-xmark"></i>
        </button>
      </div>
      <div class="px-5 py-4">
        <p id="ui-alert-msg" class="text-sm text-gray-700"></p>
      </div>
      <div class="px-5 py-4 bg-gray-50 border-t flex justify-end gap-2">
        <button id="ui-alert-close" type="button" class="btn-primary text-sm px-4 py-2">OK</button>
      </div>
    </div>
  </div>

  <!-- NICE CONFIRM MODAL -->
  <div id="ui-confirm" class="hidden fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-xl overflow-hidden">
      <div class="px-5 py-4 flex items-center gap-3 bg-gray-50 border-b">
        <div id="ui-confirm-icon" class="w-10 h-10 rounded-xl flex items-center justify-center bg-yellow-100 text-yellow-700">
          <i class="fas fa-circle-exclamation"></i>
        </div>
        <div class="min-w-0">
          <div id="ui-confirm-title" class="font-black text-gray-900">Confirm</div>
          <div id="ui-confirm-sub" class="text-xs text-gray-500">Please confirm</div>
        </div>
        <button id="ui-confirm-close-x" type="button"
                class="ml-auto w-9 h-9 rounded-full bg-white border hover:bg-gray-50 flex items-center justify-center">
          <i class="fas fa-xmark"></i>
        </button>
      </div>
      <div class="px-5 py-4">
        <p id="ui-confirm-msg" class="text-sm text-gray-700"></p>
      </div>
      <div class="px-5 py-4 bg-gray-50 border-t flex justify-end gap-2">
        <button id="ui-confirm-cancel" type="button" class="btn-secondary text-sm px-4 py-2">Cancel</button>
        <button id="ui-confirm-ok" type="button" class="btn-primary text-sm px-4 py-2">Confirm</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="ui-toast" class="hidden fixed bottom-6 right-6 z-[999]">
    <div class="bg-gray-900 text-white text-sm px-4 py-3 rounded-xl shadow-lg flex items-center gap-2">
      <i class="fas fa-check-circle"></i>
      <span id="ui-toast-msg">Done</span>
    </div>
  </div>

  <!-- Small UI helper -->
  <script>
    (function () {
      // ALERT
      const aModal = document.getElementById("ui-alert");
      const aCloseBtn = document.getElementById("ui-alert-close");
      const aCloseX = document.getElementById("ui-alert-close-x");
      const aTitle = document.getElementById("ui-alert-title");
      const aSub = document.getElementById("ui-alert-sub");
      const aMsg = document.getElementById("ui-alert-msg");
      const aIconBox = document.getElementById("ui-alert-icon");

      window.uiAlert = function ({ type = "info", titleText = "Message", subText = "", message = "" }) {
        aTitle.textContent = titleText;
        aSub.textContent = subText;
        aMsg.textContent = message;

        const map = {
          success: { bg: "bg-green-100", txt: "text-green-700", ico: "fa-check" },
          error:   { bg: "bg-red-100",   txt: "text-red-700",   ico: "fa-triangle-exclamation" },
          warn:    { bg: "bg-yellow-100",txt: "text-yellow-700",ico: "fa-circle-exclamation" },
          info:    { bg: "bg-blue-100",  txt: "text-blue-700",  ico: "fa-circle-info" },
        };
        const v = map[type] || map.info;

        aIconBox.className = `w-10 h-10 rounded-xl flex items-center justify-center ${v.bg} ${v.txt}`;
        aIconBox.innerHTML = `<i class="fas ${v.ico}"></i>`;

        aModal.classList.remove("hidden");
      };

      function hideAlert() { aModal.classList.add("hidden"); }
      aCloseBtn?.addEventListener("click", hideAlert);
      aCloseX?.addEventListener("click", hideAlert);
      aModal?.addEventListener("click", (e) => { if (e.target === aModal) hideAlert(); });

      // CONFIRM
      const cModal = document.getElementById("ui-confirm");
      const cTitle = document.getElementById("ui-confirm-title");
      const cSub = document.getElementById("ui-confirm-sub");
      const cMsg = document.getElementById("ui-confirm-msg");
      const cOk = document.getElementById("ui-confirm-ok");
      const cCancel = document.getElementById("ui-confirm-cancel");
      const cCloseX = document.getElementById("ui-confirm-close-x");

      window.uiConfirm = function ({
        titleText = "Confirm",
        subText = "",
        message = "Are you sure?",
        okText = "Confirm",
        cancelText = "Cancel"
      } = {}) {
        return new Promise((resolve) => {
          cTitle.textContent = titleText;
          cSub.textContent = subText;
          cMsg.textContent = message;
          cOk.textContent = okText;
          cCancel.textContent = cancelText;

          cModal.classList.remove("hidden");

          const cleanup = () => {
            cModal.classList.add("hidden");
            cOk.onclick = null;
            cCancel.onclick = null;
            cCloseX.onclick = null;
            cModal.onclick = null;
          };

          cOk.onclick = () => { cleanup(); resolve(true); };
          cCancel.onclick = () => { cleanup(); resolve(false); };
          cCloseX.onclick = () => { cleanup(); resolve(false); };
          cModal.onclick = (e) => { if (e.target === cModal) { cleanup(); resolve(false); } };
        });
      };

      // TOAST
      const toast = document.getElementById("ui-toast");
      const toastMsg = document.getElementById("ui-toast-msg");
      let toastTimer = null;

      window.uiToast = function (message) {
        toastMsg.textContent = message || "Done";
        toast.classList.remove("hidden");
        clearTimeout(toastTimer);
        toastTimer = setTimeout(() => toast.classList.add("hidden"), 2200);
      };

      // ESC close
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          if (!aModal.classList.contains("hidden")) aModal.classList.add("hidden");
          if (!cModal.classList.contains("hidden")) cModal.classList.add("hidden");
        }
      });
    })();
  </script>

  <script type="module" src="js/admin.js"></script>
  <script type="module" src="js/admin-dashboard.js"></script>

</body>
</html>
